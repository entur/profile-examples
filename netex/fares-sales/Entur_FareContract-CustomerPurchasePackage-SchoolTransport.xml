<?xml version="1.0" encoding="UTF-8"?>

<!-- 
    Example of Norwegian school period pass,
    with alternative approaches to structuring CustomerPurchasePackages.
-->

<PublicationDelivery 
  xmlns="http://www.netex.org.uk/netex" 
  version="1.10:NO-NeTEx-fares:0.9">
    
    <PublicationTimestamp>2020-12-04T12:34:56</PublicationTimestamp>
    <ParticipantRef>ENT</ParticipantRef>
 
    <dataObjects>

        <!-- Reference data START -->

        <ResourceFrame id="ENT:ResourceFrame:1" version="1">
            <organisations>
                <Authority id="ENT:Authority:ENT" version="1">
                    <Name>Entur School Transport Service Inc</Name>
                </Authority>
            </organisations>
        </ResourceFrame>



        <FareFrame id="ENT:FareFrame:1" version="1">

            <timeIntervals>
                <TimeInterval id="ENT:TimeInterval:SchoolMorning" version="1">
                    <StartTime>07:00:00</StartTime>
                    <EndTime>09:00:00</EndTime>
                </TimeInterval>
                <TimeInterval id="ENT:TimeInterval:SchoolAfternoon" version="1">
                    <StartTime>12:00:00</StartTime>
                    <EndTime>18:00:00</EndTime>
                </TimeInterval>
                <TimeInterval id="ENT:TimeInterval:90Min" version="1">
                    <Duration>PT90M</Duration>
                </TimeInterval>
            </timeIntervals>


            <qualityStructureFactors>
                <QualityStructureFactor id="ENT:QualityStructureFactor:190" version="1">
                    <Name>190 activations</Name>
                    <Factor>activation</Factor>
                    <Value>190</Value>
                </QualityStructureFactor>
                <QualityStructureFactor id="ENT:QualityStructureFactor:380" version="1">
                    <Name>380 activations</Name>
                    <Factor>activation</Factor>
                    <Value>380</Value>
                </QualityStructureFactor>
            </qualityStructureFactors>


            <validableElements>
                <ValidableElement id="ENT:ValidableElement:SingleTrip" version="1">
                    <Name>Enkelttur Entur</Name>
                </ValidableElement>
            </validableElements>


            <usageParameters>
                <UserProfile id="ENT:UserProfile:Pupil" version="1">
                    <Name lang="no">Skolelev</Name>
                    <ProofRequired>identityDocument</ProofRequired>
                    <!-- Skolekort -->
                </UserProfile>
            </usageParameters>


            <fareProducts>
                <AmountOfPriceUnitProduct id="ENT:AmountOfPriceUnitProduct:SchoolCarnet" version="1">
                    <Name lang="no">Skolekort med fast antall reiser</Name>
                    <accessRightsInProduct>
                        <AccessRightInProductRef ref="ENT:ValidableElement:SingleTrip" version="1"/>
                    </accessRightsInProduct>
                </AmountOfPriceUnitProduct>
            </fareProducts>


            <salesOfferPackages>
                <SalesOfferPackage id="ENT:SalesOfferPackage:SchoolCarnet" version="1">
                    <Name lang="no">Skolekort Bergen</Name>
                    <salesOfferPackageElements>
                        <SalesOfferPackageElement id="ENT:SalesOfferPackageElement:SchoolCarnet" version="1" order="1">
                            <Name lang="no">Skolekort</Name>
                            <AmountOfPriceUnitProductRef ref="ENT:AmountOfPriceUnitProduct:SchoolCarnet" version="1"/>
                        </SalesOfferPackageElement>
                    </salesOfferPackageElements>
                </SalesOfferPackage>
            </salesOfferPackages>
        </FareFrame>



        <ServiceCalendarFrame id="ENT:ServiceCalendarFrame:1" version="1">
            <ServiceCalendar id="ENT:ServiceCalendar:1" version="1">
                <Name>Skolerute Bergen 2020-2021</Name>
                <!-- Start date of validity bits, first bit represents this date -->
                <FromDate>2020-08-17</FromDate>
                <!-- Only necessary to validate that enough validity bits are present -->
                <ToDate>2020-12-31</ToDate>
                <timebands>
                    <Timeband id="ENT:Timeband:SchoolMorning" version="1">
                        <StartTime>07:00:00</StartTime>
                        <EndTime>09:00:00</EndTime>
                    </Timeband>
                    <Timeband id="ENT:Timeband:SchoolAfternoon" version="1">
                        <StartTime>12:00:00</StartTime>
                        <EndTime>16:00:00</EndTime>
                    </Timeband>
                </timebands>
                <operatingPeriods>
                    <UicOperatingPeriod id="ENT:UicOperatingPeriod:1" version="1">
                        <!-- Start date of validity bits, first bit represents this date -->
                        <FromDate>2020-08-17T00:00:00</FromDate>
                        <!-- Only necessary to validate that enough validity bits are present -->
                        <ToDate>2021-06-18T00:00:00</ToDate>
                        <ValidDayBits>
                            1111100 <!-- week 34 -->
                            1111100 <!-- week 35 -->
                            1111100 <!-- week 36 -->
                            1111100 <!-- week 37 -->
                            1111100 <!-- week 38 -->
                            1111100 <!-- week 39 -->
                            1111100 <!-- week 40 -->
                            1111100 <!-- week 41 -->
                            1111100 <!-- week 42 -->
                            1111100 <!-- week 43 -->
                            1111100 <!-- week 44 -->
                            1111100 <!-- week 45 -->
                            1111100 <!-- week 46 -->
                            1111100 <!-- week 47 -->
                            1111100 <!-- week 48 -->
                            1111100 <!-- week 49 -->
                            1111100 <!-- week 50 -->
                            1111100 <!-- week 51 -->
                            1111100 <!-- week 52 -->
                            1111 <!-- week 53 -->
                        </ValidDayBits>
                    </UicOperatingPeriod>
                </operatingPeriods>
            </ServiceCalendar>
        </ServiceCalendarFrame>



        <SalesTransactionFrame id="ENT:SalesTransactionFrame:Case1" version="1">

            <customerAccounts>
                <CustomerAccount id="ENT:CustomerAccount:1" version="1">
                    <!-- Dummy data (unused placeholder) -->
                </CustomerAccount>
            </customerAccounts>

            <fareContracts>
                <FareContract id="ENT:FareContract:1" version="1">
                    <Name>Skolekort Bergen</Name>
                    <StartDate>2020-09-06T01:07:00</StartDate>
                    <EndDate>2021-09-07T01:07:00</EndDate>
                    <fareContractEntries>
                        <!-- Dummy, only way in official netex to get a CPP in is via SalesTransaction -->
                        <SalesTransaction version="1" id="ENT:SalesTransaction:1">
                            <Name>Kjøp Skoleskyss</Name>
                            <Date>2020-09-06T01:07:00</Date>
                            <Amount>10000</Amount>
                            <Currency>NOK</Currency>
                            <PaymentMethod>debitCard</PaymentMethod>
                            <customerPurchasePackages>
                                <!-- Reference to customer purchase packages -->
                                <CustomerPurchasePackageRef ref="ENT:CustomerPurchasePackage:SchoolTransport" version="1"/>
                            </customerPurchasePackages>
                        </SalesTransaction>
                    </fareContractEntries>
                </FareContract>
            </fareContracts>



            <!-- 
                === SCHOOL TRANSPORT SAMPLE ===
            -->
            <customerPurchasePackages>
                <CustomerPurchasePackage id="ENT:CustomerPurchasePackage:SchoolTransport" version="1">
                    <SalesOfferPackageRef ref="ENT:SalesOfferPackage:SchoolTransport"/>
                    <customerPurchasePackageElements>
                        <CustomerPurchasePackageElement id="ENT:CustomerPurchasePackageElement:SchoolTransport" version="1" order="1">
                            <validityParameterAssignments>
                                
                                <!-- School transport: ALTERNATIVE 1 for recording access right parameter -->
                                
                                <CustomerPurchaseParameterAssignment version="1" id="ENT:CustomerPurchaseParameterAssignment:ForbrukGjennomSkoleår" order="1">
                                    <ValidableElementRef ref="ENT:ValidableElement:SingleTrip" version="1"/>
                                    <AmountOfPriceUnitProductRef ref="ENT:AmountOfPriceUnitProduct:SchoolCarnet" version="1"/>
                                    <LimitationGroupingType>AND</LimitationGroupingType>
                                    <limitations>
                                        <FrequencyOfUse id="ENT:FrequencyOfUse:SchoolMorning" version="1">
                                            <Name>1 trip in the morning</Name>
                                            <FrequencyOfUseType>single</FrequencyOfUseType>
                                            <MaximalFrequency>1</MaximalFrequency>
                                            <FrequencyInterval>P1D</FrequencyInterval>
                                            <!-- TODO how to specify start of day? / operating day? -->
                                            <TimeIntervalRef ref="ENT:TimeInterval:SchoolMorning" version="1"/>
                                        </FrequencyOfUse>
                                        <FrequencyOfUse id="ENT:FrequencyOfUse:SchoolAfternoon" version="1">
                                            <Name>1 trip in the afternoon</Name>
                                            <FrequencyOfUseType>single</FrequencyOfUseType>
                                            <MaximalFrequency>1</MaximalFrequency>
                                            <FrequencyInterval>P1D</FrequencyInterval>
                                            <TimeIntervalRef ref="ENT:TimeInterval:SchoolAfternoon" version="1"/>
                                        </FrequencyOfUse>

                                        <!-- These 2 FrequencyOfUse below is only necessary if the overall school calendar availabilityCondition is 
                                            not strict enough. A use case is children with 2 homes, one requiring school transport and one that does not -->
                                        <FrequencyOfUse id="ENT:FrequencyOfUse:MorningTotalCount" version="1">
                                            <Name>Maximum 190 trips in the morning to school in a year</Name>
                                            <FrequencyOfUseType>limited</FrequencyOfUseType>
                                            <MaximalFrequency>190</MaximalFrequency>
                                            <TimeIntervalRef ref="ENT:TimeInterval:SchoolMorning" version="1"/>
                                        </FrequencyOfUse>
                                        <FrequencyOfUse id="ENT:FrequencyOfUse:SchoolAfternoonTotalCount" version="1">
                                            <Name>Maximum 190 trips home from school in a year</Name>
                                            <FrequencyOfUseType>limited</FrequencyOfUseType>
                                            <MaximalFrequency>190</MaximalFrequency>
                                            <TimeIntervalRef ref="ENT:TimeInterval:SchoolAfternoon" version="1"/>
                                        </FrequencyOfUse>

                                        <UserProfileRef ref="ENT:UserProfile:Pupil" version="1"/>

                                        <UsageValidityPeriod id="ENT:UsageValidityPeriod:90Min" version="1">
                                            <UsageTrigger>startOutboundRide</UsageTrigger>
                                            <UsageEnd>standardDuration</UsageEnd>
                                            <StandardDuration>PT90M</StandardDuration>
                                            <ActivationMeans>useOfMobileDevice</ActivationMeans>
                                            <!-- TODO must be list and include useOfValidator -->
                                        </UsageValidityPeriod>
                                    </limitations>

                                    <ValidityParameterGroupingType>AND</ValidityParameterGroupingType>
                                    <temporalValidityParameters>
                                        <!-- FIX: Has been added as Pull Request (https://github.com/NeTEx-CEN/NeTEx/pull/136) but not yet merged -->
                                        <!--ServiceCalendarRef ref="SKY:SchoolCalendar:SchoolCalendarBergen2020-2021"/ -->
                                    </temporalValidityParameters>
                                    <validityParameters>
                                        <AuthorityRef ref="ENT:Authority:ENT" version="1"/>
                                        <TariffZoneRef ref="ENT:TariffZone:SkolekretsX"/>
                                    </validityParameters>

                                </CustomerPurchaseParameterAssignment>


                                <!-- School transport: ALTERNATIVE 2 for recording access right parameter -->

                                <CustomerPurchaseParameterAssignment version="1" id="ENT:CustomerPurchaseParameterAssignment:ForbrukGjennomSkoleårV2-1" order="1">
                                    <ValidableElementRef ref="ENT:ValidableElement:SingleTrip" version="1"/>
                                    <LimitationGroupingType>AND</LimitationGroupingType>
                                    <limitations>

                                        <!-- Limit to -->
                                        <FrequencyOfUse id="ENT:FrequencyOfUse:SchoolMorningV2-1" version="1">
                                            <Name>1 trip in the morning</Name>
                                            <FrequencyOfUseType>single</FrequencyOfUseType>
                                            <MaximalFrequency>1</MaximalFrequency>
                                            <FrequencyInterval>P1D</FrequencyInterval>
                                            <!-- TODO how to specify start of day? / operating day? -->
                                            <TimeIntervalRef ref="ENT:TimeInterval:SchoolMorning" version="1"/>
                                        </FrequencyOfUse>
                                        <!-- Limit to -->
                                        <FrequencyOfUse id="ENT:FrequencyOfUse:SchoolAfternoonV2-1" version="1">
                                            <Name>1 trip in the afternoon</Name>
                                            <FrequencyOfUseType>single</FrequencyOfUseType>
                                            <MaximalFrequency>1</MaximalFrequency>
                                            <FrequencyInterval>P1D</FrequencyInterval>
                                            <TimeIntervalRef ref="ENT:TimeInterval:SchoolAfternoon" version="1"/>
                                        </FrequencyOfUse>

                                        <!-- These 2 FrequencyOfUse below is only necessary if the overall school calendar availabilityCondition is 
                                            not strict enough. A use case is children with 2 homes, one requiring school transport and one that does not -->
                                        <!-- Limit to -->
                                        <FrequencyOfUse id="ENT:FrequencyOfUse:MorningTotalCountV2-1" version="1">
                                            <Name>Maximum 190 trips in the morning to school in a year</Name>
                                            <FrequencyOfUseType>limited</FrequencyOfUseType>
                                            <MaximalFrequency>190</MaximalFrequency>
                                            <TimeIntervalRef ref="ENT:TimeInterval:SchoolMorning" version="1"/>
                                        </FrequencyOfUse>
                                        <!-- Limit to -->
                                        <FrequencyOfUse id="ENT:FrequencyOfUse:SchoolAfternoonTotalCountV2-1" version="1">
                                            <Name>Maximum 190 trips home from school in a year</Name>
                                            <FrequencyOfUseType>limited</FrequencyOfUseType>
                                            <MaximalFrequency>190</MaximalFrequency>
                                            <TimeIntervalRef ref="ENT:TimeInterval:SchoolAfternoon" version="1"/>
                                        </FrequencyOfUse>

                                        <!-- No trigger, does not change, cannot be actvated -->
                                        <UsageValidityPeriod id="ENT:UsageValidityPeriod:SchoolYear-1" version="1">
                                            <StartDate>2020-08-21</StartDate>
                                            <EndDate>2020-12-31</EndDate>
                                        </UsageValidityPeriod>
                                    </limitations>
                                    <!-- To represent zonal Season passes, FARE ZONEs are defined for each zone and a Greater Anglia specific product is defined for the SEASON PASS. Its tariff allows different combinations of zone and TIME INTERVAL to be selected. -->
                                    <ValidityParameterGroupingType>AND</ValidityParameterGroupingType>
                                    <temporalValidityParameters>
                                        <!-- FIX: Has been added as Pull Request (https://github.com/NeTEx-CEN/NeTEx/pull/136) but not yet merged -->
                                        <!--ServiceCalendarRef ref="SKY:SchoolCalendar:SchoolCalendarBergen2020-2021"/ -->
                                    </temporalValidityParameters>
                                </CustomerPurchaseParameterAssignment>

                                <CustomerPurchaseParameterAssignment version="1" id="ENT:CustomerPurchaseParameterAssignment:ForbrukGjennomSkoleårV2" order="1">
                                    <ValidableElementRef ref="ENT:ValidableElement:SingleTrip" version="1"/>
                                    <AmountOfPriceUnitProductRef ref="ENT:AmountOfPriceUnitProduct:SchoolCarnet" version="1"/>
                                    <LimitationGroupingType>AND</LimitationGroupingType>
                                    <limitations>
                                        <!-- Activated by trigger -->
                                        <UsageValidityPeriod id="ENT:UsageValidityPeriod:WhatYouGetOnEachActivation" version="1">
                                            <UsageTrigger>startOutboundRide</UsageTrigger>
                                            <UsageEnd>standardDuration</UsageEnd>
                                            <StandardDuration>PT90M</StandardDuration>
                                            <ActivationMeans>useOfMobileDevice</ActivationMeans>
                                            <!-- TODO must be list and include useOfValidator -->
                                        </UsageValidityPeriod>
                                    </limitations>
                                    <!-- Number of activations possible -->
                                    <QualityStructureFactorRef ref="ENT:QualityStructureFactor:380" version="1"/>
                                </CustomerPurchaseParameterAssignment>

                                <CustomerPurchaseParameterAssignment version="1" id="ENT:CustomerPurchaseParameterAssignment:ForbrukGjennomSkoleårV2-3" order="1">
                                    <ValidableElementRef ref="ENT:ValidableElement:SingleTrip" version="1"/>
                                    <AmountOfPriceUnitProductRef ref="ENT:AmountOfPriceUnitProduct:SchoolCarnet" version="1"/>
                                    <LimitationGroupingType>AND</LimitationGroupingType>
                                    <limitations>
                                        <UserProfileRef ref="ENT:UserProfile:Pupil" version="1"/>
                                    </limitations>
                                    <!-- To represent zonal Season passes, FARE ZONEs are defined for each zone and a Greater Anglia specific product is defined for the SEASON PASS. Its tariff allows different combinations of zone and TIME INTERVAL to be selected. -->
                                    <ValidityParameterGroupingType>AND</ValidityParameterGroupingType>
                                    <validityParameters>
                                        <AuthorityRef ref="ENT:Authority:ENT" version="1"/>
                                        <TariffZoneRef ref="ENT:TariffZone:SkolekretsX"/>
                                    </validityParameters>
                                </CustomerPurchaseParameterAssignment>
                            </validityParameterAssignments>
                        </CustomerPurchasePackageElement>

                    </customerPurchasePackageElements>
                </CustomerPurchasePackage>

            </customerPurchasePackages>

        </SalesTransactionFrame>

    </dataObjects>
</PublicationDelivery>
